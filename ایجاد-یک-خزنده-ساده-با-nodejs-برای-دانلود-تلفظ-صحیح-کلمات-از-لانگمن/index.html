<!DOCTYPE html><html><head><title>ایجاد یک خزنده ساده با Nodejs برای دانلود تلفظ صحیح کلمات از لانگمن</title><meta charset="utf-8" /><meta content='text/html; charset=utf-8' http-equiv='Content-Type'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'><meta property="og:locale" content="fa_IR" /><meta property="og:site_name" content="پول ریکوئست" /><meta name="twitter:image" content="/assets/images/pr.svg" /><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="theme-color" content="#000"><meta property="og:type" content="article" /><meta name="description" content="خزیدن در یک وب‌سایت و شروع به استخراج اطلاعات اون، یکی از کارهای ساده و جذابیه که می‌شه با استفاده از Node.js انجام داد. من توی یکی از پروژه‌های خودم، نیاز به دانلود تلفظ صحیح کلمات انگلیسی از سایت دیکشنری آنلاین لانگمن داشتم، تصمیم گرفتم که این ابزار کوچک رو تحت عنوان یک پروژه آموزشی در اختیار بقیه قرار بدم. " /><meta property="og:description" content="خزیدن در یک وب‌سایت و شروع به استخراج اطلاعات اون، یکی از کارهای ساده و جذابیه که می‌شه با استفاده از Node.js انجام داد. من توی یکی از پروژه‌های خودم، نیاز به دانلود تلفظ صحیح کلمات انگلیسی از سایت دیکشنری آنلاین لانگمن داشتم، تصمیم گرفتم که این ابزار کوچک رو تحت عنوان یک پروژه آموزشی در اختیار بقیه قرار بدم. " /><meta name="twitter:card" content="summary" /><meta name="twitter:description" content="خزیدن در یک وب‌سایت و شروع به استخراج اطلاعات اون، یکی از کارهای ساده و جذابیه که می‌شه با استفاده از Node.js انجام داد. من توی یکی از پروژه‌های خودم، نیاز به دانلود تلفظ صحیح کلمات انگلیسی از سایت دیکشنری آنلاین لانگمن داشتم، تصمیم گرفتم که این ابزار کوچک رو تحت عنوان یک پروژه آموزشی در اختیار بقیه قرار بدم. " /><meta name="author" content="پول ریکوئست به قلم jmosawy" /><meta property="og:title" content="ایجاد یک خزنده ساده با Nodejs برای دانلود تلفظ صحیح کلمات از لانگمن" /><meta property="twitter:title" content="ایجاد یک خزنده ساده با Nodejs برای دانلود تلفظ صحیح کلمات از لانگمن" /><link rel="stylesheet" type="text/css" href="/style.css" /><link rel="alternate" type="application/rss+xml" title="پول ریکوئست - پول ریکوئست، دست نوشته های فنی فارسی زبان" href="/feed.xml" /> <script src="/pr.js"></script><body><div class="site__container"><header class="site__header container"><figure class="site__header__brand"> <a href="http://pullrequest.ir"> <img src="/assets/images/pr.svg" alt="PR"> </a></figure><nav class="site__header__nav"><ul class="list--unstyled list--inline header__list text--center"><li> <a href="/about">پول ریکوئست چیست</a><li> <a href="/pr-authors">نویسندگان</a><li> <a href="/contribute">راهنمای انتشار مطالب در پول ریکوئست</a></ul></nav></header><hr class="site__header__divider container" /><main role="main" class="container"><article class="post post--single"><h1 class="post__title post__title--single">ایجاد یک خزنده ساده با Nodejs برای دانلود تلفظ صحیح کلمات از لانگمن</h1><div class="post__info"> <span> <span class="lazyimage"> <img onload="window.pr.methods.addClass('img-loaded', this.parentNode)" onerror="window.pr.methods.addClass('img-error', this)" src="/assets/images/jmosawy.jpg" alt="جف موسوی" class="img-rounded post__info__figure inline--middle" > </span> <span class="inline--middle post__author"><a href="http://pullrequest.ir/authors/jmosawy">جف موسوی</a></span> </span> <small><em>1396-2-8</em></small></div><div class="post__share text--left"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%DB%8C%DA%A9-%D8%AE%D8%B2%D9%86%D8%AF%D9%87-%D8%B3%D8%A7%D8%AF%D9%87-%D8%A8%D8%A7-nodejs-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%AF%D8%A7%D9%86%D9%84%D9%88%D8%AF-%D8%AA%D9%84%D9%81%D8%B8-%D8%B5%D8%AD%DB%8C%D8%AD-%DA%A9%D9%84%D9%85%D8%A7%D8%AA-%D8%A7%D8%B2-%D9%84%D8%A7%D9%86%DA%AF%D9%85%D9%86/&via=http://pullrequest.ir&text=ایجاد یک خزنده ساده با Nodejs برای دانلود تلفظ صحیح کلمات از لانگمن"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%DB%8C%DA%A9-%D8%AE%D8%B2%D9%86%D8%AF%D9%87-%D8%B3%D8%A7%D8%AF%D9%87-%D8%A8%D8%A7-nodejs-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%AF%D8%A7%D9%86%D9%84%D9%88%D8%AF-%D8%AA%D9%84%D9%81%D8%B8-%D8%B5%D8%AD%DB%8C%D8%AD-%DA%A9%D9%84%D9%85%D8%A7%D8%AA-%D8%A7%D8%B2-%D9%84%D8%A7%D9%86%DA%AF%D9%85%D9%86/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul><nav class="post__tags post__tags--single"> <i class="icon pricon-tag"></i><ul class="list--unstyled list--inline"><li><a href="/tag/nodejs">#Nodejs</a><li><a href="/tag/crawler">#crawler</a></ul></nav></div><div class="post__entry post__entry--single"><p>خزیدن در یک وب‌سایت و شروع به استخراج اطلاعات اون، یکی از کارهای ساده و جذابیه که می‌شه با استفاده از Node.js انجام داد. من توی یکی از پروژه‌های خودم، نیاز به دانلود تلفظ صحیح کلمات انگلیسی از سایت دیکشنری آنلاین <strong><a href="http://www.ldoceonline.com">لانگمن</a></strong> داشتم، تصمیم گرفتم که این ابزار کوچک رو تحت عنوان یک پروژه آموزشی در اختیار بقیه قرار بدم.<p>این پروژه از طریق مخزن <strong><a href="https://github.com/jmosawy/LDOCE-Pronunciation-Audio-Downloader">گیت‌هاب</a></strong> در دسترس هست و اگر فکر می‌کنید این آموزش برای شما ساده هست، می‌تونید کد نهایی رو در اختیار داشته باشید.<h2 id="کتابخانههای-استفاده-شده">کتابخانه‌های استفاده شده</h2><p>برای توسعه این ابزار، نیاز به دو کتابخانه اساسی جهت خزیدن در وب‌سایت و دانلود محتوا خواهیم داشت که هریک به شرح زیر هستند:<h3 id="کتابخانه-request"><a href="https://github.com/request/request">کتابخانه Request</a></h3><p>با استفاده از این کتابخانه، می‌تونیم درخواست‌های HTTP ارسال کنیم و جوابی که از سمت سرور ارسال می‌شه رو دریافت کنیم؛ پس حتماً متوجه شدید که این کتابخانه به ما کمک می‌کنه که سورس HTML سایت رو دریافت کنیم تا بتونیم محتوای داخل یک صفحه رو بخونیم.<h3 id="کتابخانه-cheerio"><a href="https://cheerio.js.org/">کتابخانه Cheerio</a></h3><p>این کتابخانه که APIهایی شبیه به jQuery داره به شما کمک می‌کنه تا به المنت‌های مختلف در صفحه با استفاده از Selectorهایی شبیه به آنچه که در jQuery داشتیم، دست پیدا کنیم.<h2 id="دست-به-عمل-بشیم">دست به عمل بشیم…</h2><p>در ابتدا و طبق عادت خودم، ترمینال رو باز می‌کنیم و دستور ایجاد یک پروژه npm رو می‌زنیم:<p><code class="highlighter-rouge">npm init -y</code><p>با استفاده از دستور فوق، یک فایل <em>package.json</em> در پوشه‌ای که هستید ایجاد می‌شه؛ باید دو کتابخانه‌ای که قبلاً اسم بردم رو نصب کنیم، پس در ادامه در محیط ترمینال می‌نویسم:<p><code class="highlighter-rouge">npm install cheerio request --save</code><p>کمی صبر می‌کنیم تا کتابخانه‌ها نصب بشه…<p>یک فایل با اسم <em>index.js</em> (یا هر اسمی که خودتون دوست دارید) بسازید و کدهای زیر رو کپی و پیست کنید:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'request'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cheerio</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'cheerio'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">downloadPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'downloads/'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">ameClass</span> <span class="o">=</span> <span class="s1">'.speaker.amefile'</span><span class="p">,</span>
  <span class="nx">breClass</span> <span class="o">=</span> <span class="s1">'.speaker.brefile'</span>


<span class="kd">function</span> <span class="nx">normalizer</span><span class="p">(</span><span class="nx">word</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">word</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\s</span><span class="sr">+/g</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">fileDownloader</span><span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">downloadPath</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">mkdir</span><span class="p">(</span><span class="nx">downloadPath</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">let</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">request</span>
    <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">err</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'response'</span><span class="p">,</span> <span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">downloadPath</span><span class="p">,</span> <span class="s2">`</span><span class="p">${</span><span class="nx">fileName</span><span class="p">}</span><span class="s2">.mp3`</span><span class="p">)));</span>
    <span class="p">})</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="nx">word</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">request</span><span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">cheerio</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">ameFile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ameClass</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'src-mp3'</span><span class="p">),</span>
      <span class="nx">breFile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">breClass</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'src-mp3'</span><span class="p">);</span>


    <span class="c1">// Downloading American Pronunciation</span>
    <span class="nx">fileDownloader</span><span class="p">(</span><span class="nx">ameFile</span><span class="p">,</span> <span class="s2">`ame-</span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

    <span class="c1">// Downloading British Pronunciation</span>
    <span class="nx">fileDownloader</span><span class="p">(</span><span class="nx">breFile</span><span class="p">,</span> <span class="s2">`bre-</span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">word</span> <span class="o">=</span> <span class="nx">normalizer</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="nx">main</span><span class="p">(</span><span class="s2">`http://www.ldoceonline.com/dictionary/</span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span> <span class="nx">word</span><span class="p">);</span></code></pre></figure><p>خب؛ جای هیچ نگرانی‌ای برای گیج شدن نیست! قسمت به قسمت کدها رو توضیح می‌دیم تا ببینیم هر قسمت چه کاری رو انجام می‌ده!<p>خب، به این قسمت از کد توجه کنید که در حال تعریف چندین متغیر هستیم:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'request'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'path'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cheerio</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'cheerio'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">downloadPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'downloads/'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">ameClass</span> <span class="o">=</span> <span class="s1">'.speaker.amefile'</span><span class="p">,</span>
  <span class="nx">breClass</span> <span class="o">=</span> <span class="s1">'.speaker.brefile'</span></code></pre></figure><p>متغیرهای <strong>request</strong>، <strong>fs</strong>، <strong>path</strong> و <strong>cheerio</strong> هرکدام برای فراخوانی کتابخانه‌های خودشون هستند. با استفاده از کتابخانه‌های path و fs که همراه با Node.js هست، مسیر ذخیره فایل و خود عملیات ذخیره‌سازی فایل‌های دانلود شده را -به‌ترتیب- انجام می‌دیم.<p>متغیرهای <em>ameClass</em> و <em>breClass</em> هم در واقع selectorهای المانی‌هایی هستند که قرار است فایل تلفظ لغت را از آن‌ها استخراج کنیم. در ادامه بیشتر توضیح خواهم داد.<p>اینکه چطور می‌خوایم دیتایی که لازم داریم را از سایت لانگمن استخراج کنیم، به این شکل هست: فرض کنیم می‌خوایم تلفظ لغت <code class="highlighter-rouge">take off</code> را دانلود کنیم. اگر این لغت داخل سایت جستجو بشه، می‌بینید که URL به این شکل هست: http://www.ldoceonline.com/dictionary/take-off<p>چند نکته باید در رابطه با URL لغات توجه کنیم؛ اول اینکه لغت‌های ترکیبی با خط تیره جدا شده و دوم، تمامی حروف لغت‌ها بصورت کوچک (lowercase) نوشته شده‌اند. پس باید در ابتدا یک فانکشنی رو تعریف کنیم که کار استاندارسازی (یا اصطلاحاً normalize کردن) را برای ما انجام بده، پس به این صورت تعریف می‌کنیم:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">normalizer</span><span class="p">(</span><span class="nx">word</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">word</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\s</span><span class="sr">+/g</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure><p>حالا اگر URL بالا را باز کنید و کمی به پایین اسکرول کنید، می‌بینید که دو تا آیکون بلندگو (استقلالی و پرسپولیسی) هست که استقلالی تلفظ آمریکایی و پرسپولیسی تلفظ بریتانیایی هر لغت رو نشون می‌ده.<p><img src="https://preview.ibb.co/ivNiJ5/1_oj3x_PRx6d_NNvake3_g_Rc_TQ.png" alt="بخشی از سایت لانگمن" /><p>اگر از ابزار inspect element مرورگر استفاده کنید، می‌بینید که هر کدام از این‌ها یک تگ <em>span</em> به شکل زیر هستند:<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;span</span>
<span class="na">data-src-mp3=</span><span class="s">”http://www.ldoceonline.com/media/english/breProns/brelasdetake-off.mp3"</span>
<span class="na">class=</span><span class="s">”speaker</span> <span class="na">brefile</span> <span class="na">fa</span> <span class="na">fa-volume-up</span><span class="err">”</span>
<span class="na">title=</span><span class="s">”…”</span>
<span class="nt">&gt;</span>
<span class="nt">&lt;/span&gt;</span></code></pre></figure><p>دو attribute مهم در این تگ وجود داره؛ یکی <em>data-src-mp3</em> و دیگری class. با استفاده از اولی می‌تونیم URL فایل صوتی رو بدست بیاریم و با استفاده از دومی می‌شه حین خزیدن در داخل سایت بهش اشاره کنیم و اون رو به اصطلاح select کنیم. پس باید متوجه شده باشید که دو متغیر <em>ameClass</em> و <em>breClass</em> برای چی تعریف شدند!<p>قسمت بعد کار، نیاز داریم تا یک دانلودر برای URL فایل صوتی ما بنویسیم؛ در واقع، یک فانکشن که لینک و اسم فایل بعنوان ورودی بگیره، و فایل رو برای ما ذخیره کنه. پس قسمت بعدی از کد به این شکل تعریف شده:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">fileDownloader</span><span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">downloadPath</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">mkdir</span><span class="p">(</span><span class="nx">downloadPath</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">let</span> <span class="nx">req</span> <span class="o">=</span> <span class="nx">request</span>
    <span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'error'</span><span class="p">,</span> <span class="nx">err</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">err</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">'response'</span><span class="p">,</span> <span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">downloadPath</span><span class="p">,</span> <span class="s2">`</span><span class="p">${</span><span class="nx">fileName</span><span class="p">}</span><span class="s2">.mp3`</span><span class="p">)));</span>
    <span class="p">})</span>
<span class="p">}</span></code></pre></figure><p>در ابتدای این کد، ابتدا چک می‌کنیم که اگر مسیری که قرار هست فایل اونجا ذخیره بشه وجود نداره (فولدرش موجود نباشه) اول فولدر رو ایجاد کنه. بعد از اون، با استفاده از ماژول <em>request</em>، درخواست به URL ارسال می‌کنیم و محتوا رو دانلود می‌کنیم.<p>آخرین فانکشن مورد نیاز ما، فانکشن <em>main</em> هست که کارهای اصلی قرار هست در اینجا رخ بده؛ به این شکل تعریف می‌کنیم:<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">main</span><span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="nx">word</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">request</span><span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">body</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">cheerio</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">body</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">ameFile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ameClass</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'src-mp3'</span><span class="p">),</span>
      <span class="nx">breFile</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">breClass</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">'src-mp3'</span><span class="p">);</span>


    <span class="c1">// Downloading American Pronunciation</span>
    <span class="nx">fileDownloader</span><span class="p">(</span><span class="nx">ameFile</span><span class="p">,</span> <span class="s2">`ame-</span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

    <span class="c1">// Downloading British Pronunciation</span>
    <span class="nx">fileDownloader</span><span class="p">(</span><span class="nx">breFile</span><span class="p">,</span> <span class="s2">`bre-</span><span class="p">${</span><span class="nx">word</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>

  <span class="p">})</span>
<span class="p">}</span></code></pre></figure><p>در این فانکشن، ابتدا درخواست به سایت لانگمن ارسال می‌کنیم تا محتوای سایت (سورس HTML) رو دریافت کنیم؛ این کار رو با استفاده از ماژول <em>request</em> انجام می‌دیم. پس از آن، از ماژول <em>cheerio</em> استفاده می‌کنیم تا سورس HTML رو داخل متغیر $ لود کنیم و classهایی که قبل‌تر در متغیرهای <em>ameClass</em> و <em>breClass</em> ذخیره کردیم را با استفاده از <em>cheerio</em> پیدا و به محتوای <em>data-src-mp3</em> دسترسی پیدا کنیم. در نهایت، با استفاده از فانکشن <strong>fileDownloader</strong>، فایل‌ها را دانلود می‌کنیم.<p>حالا که همه چیز آماده هست، با استفاده از محیط CLI، لغت کاربر را دریافت و اقدام به دانلود تلفظ صوتی می‌کنیم، پس کافیه از این به بعد دستور پایین رو بزنیم تا فایل‌ها دانلود بشه:<p><code class="highlighter-rouge">node index.js 'take off'</code><p>به جای کلمه <code class="highlighter-rouge">take off</code> می‌تونید کلمه مورد نظر خودتون رو قرار بدید.</div><div class="post__share text--center"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%DB%8C%DA%A9-%D8%AE%D8%B2%D9%86%D8%AF%D9%87-%D8%B3%D8%A7%D8%AF%D9%87-%D8%A8%D8%A7-nodejs-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%AF%D8%A7%D9%86%D9%84%D9%88%D8%AF-%D8%AA%D9%84%D9%81%D8%B8-%D8%B5%D8%AD%DB%8C%D8%AD-%DA%A9%D9%84%D9%85%D8%A7%D8%AA-%D8%A7%D8%B2-%D9%84%D8%A7%D9%86%DA%AF%D9%85%D9%86/&via=http://pullrequest.ir&text=ایجاد یک خزنده ساده با Nodejs برای دانلود تلفظ صحیح کلمات از لانگمن"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%DB%8C%DA%A9-%D8%AE%D8%B2%D9%86%D8%AF%D9%87-%D8%B3%D8%A7%D8%AF%D9%87-%D8%A8%D8%A7-nodejs-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%AF%D8%A7%D9%86%D9%84%D9%88%D8%AF-%D8%AA%D9%84%D9%81%D8%B8-%D8%B5%D8%AD%DB%8C%D8%AD-%DA%A9%D9%84%D9%85%D8%A7%D8%AA-%D8%A7%D8%B2-%D9%84%D8%A7%D9%86%DA%AF%D9%85%D9%86/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul></div><script> window.pr.methods.docReady(function() { var singleEntry = window.pr.methods.selectElementByClassName('.post__entry--single'); var excerptEntry = window.pr.methods.selectElementByClassName('.post__excerpt'); if (singleEntry) window.pr.methods.parseTextForEmojis(singleEntry); else if (excerptEntry) window.pr.methods.parseTextForEmojis(excerptEntry); }) </script><hr /><div class="comments"><div id="disqus_thread"></div><script async defer src='https://pwl-rykhwyst.disqus.com/embed.js' onerror="disqusHandler();"></script> <script type="text/javascript"> var disqusHandler = (function (w) { var methods = w.pr.methods; /* methods.docReady(function () { loadDisqusScript() }); function loadDisqusScript() { methods.getAjax('https://pwl-rykhwyst.disqus.com/embed.js', null, function (e) { addDisqusErrorIfNotPresent(); // Parse any emoji inside error methods.parseTextForEmojis(document.getElementById('comment__error')); }) } */ function addDisqusErrorIfNotPresent() { var comments = methods.selectElementByClassName('.comments'); /* Add only for the 1st time */ if (!methods.selectElementById('comment__error')) { /* Add error to .comments */ comments.appendChild(createDisqusError()); /* Parse any emoji inside error */ methods.parseTextForEmojis(document.getElementById('comment__error')); } } function createDisqusError() { var err = document.createElement('div'); err.id = 'comment__error'; window.pr.methods.addClass('alert', err); err.innerHTML = 'اگر این پیام رو میبینین، به این معنیه که اسکریپت Disqus براتون لود نشده. سرویس Disqus توی ایران فیلتر شده!! <strong>لطفا وی پی ان تون رو روشن کنین و صفحه فعلی رو ریفرش کنین.</strong> :پی'; return err; } return addDisqusErrorIfNotPresent; })(window); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></article></div><footer class="site__footer clearfix"><div class="site__footer__brand" onclick="window.pr.methods.goToTop()"> <img class="img-block" src="/assets/images/pr.svg" alt="PR"></div><div class="container clearfix"><nav class="pull-right site__footer__menu"><ul class="list--unstyled list--inline site__footer__list"><li> <a target="_blank" href="https://github.com/pr-techblog"> <i class="icon pricon-github"></i> گیتهاب </a><li> <a target="_blank" href="https://twitter.com/pr_techblog"> <i class="icon pricon-twitter"></i> توییتر </a></ul></nav><div class="pull-left text--ltr site__footer__copyright">Made with ❦ @ <strong>PullRequest</strong></div></div></footer></div><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93910742-1', 'auto'); ga('send', 'pageview', { 'page': '/%D8%A7%DB%8C%D8%AC%D8%A7%D8%AF-%DB%8C%DA%A9-%D8%AE%D8%B2%D9%86%D8%AF%D9%87-%D8%B3%D8%A7%D8%AF%D9%87-%D8%A8%D8%A7-nodejs-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%AF%D8%A7%D9%86%D9%84%D9%88%D8%AF-%D8%AA%D9%84%D9%81%D8%B8-%D8%B5%D8%AD%DB%8C%D8%AD-%DA%A9%D9%84%D9%85%D8%A7%D8%AA-%D8%A7%D8%B2-%D9%84%D8%A7%D9%86%DA%AF%D9%85%D9%86/', 'title': 'ایجاد یک خزنده ساده با Nodejs برای دانلود تلفظ صحیح کلمات از لانگمن' }); </script>
