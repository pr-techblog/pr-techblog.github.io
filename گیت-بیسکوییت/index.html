<!DOCTYPE html><html><head><title>اتوماتیک گیت بای سکت یا چگونه با دو نیم کردن اتوماتیک از سکته جلوگیری کنیم</title><meta charset="utf-8" /><meta content='text/html; charset=utf-8' http-equiv='Content-Type'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'><meta property="og:locale" content="fa_IR" /><meta property="og:site_name" content="پول ریکوئست" /><meta name="twitter:image" content="/assets/images/pr.svg" /><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="theme-color" content="#000"><meta property="og:type" content="article" /><meta name="description" content="وقتی پروژه، محصول و تیم ها رشد می‌کنند، به همون اندازه پیدا کردن مشکلات و خطاهای کدها سخت تر میشه. تا جایی که بعضا دیده شده باگ هایی سهمگین موجب حملات قلبی عروقی سازمان‌یافته به مسئولین سالم نگه‌داشتن پروژه شده است. احتمالا چیزی نزدیک به همه تیم هایی که می‌شود ارزش سر آنها را بر تنشان سنجید، از مکانیزم های کنترلی، تست های فراوان، CI و … استفاده میکنند و کمتر با این مشکلات مواجه می‌شوند. امیدوارم برای شما پیش نیاد. این مقاله یک بحث فنی در مورد گیت است و در مورد یکی از امکاناتش برای یافتن کامیت مشکل دار در بین انبوهی از کامیت ها. git bisect " /><meta property="og:description" content="وقتی پروژه، محصول و تیم ها رشد می‌کنند، به همون اندازه پیدا کردن مشکلات و خطاهای کدها سخت تر میشه. تا جایی که بعضا دیده شده باگ هایی سهمگین موجب حملات قلبی عروقی سازمان‌یافته به مسئولین سالم نگه‌داشتن پروژه شده است. احتمالا چیزی نزدیک به همه تیم هایی که می‌شود ارزش سر آنها را بر تنشان سنجید، از مکانیزم های کنترلی، تست های فراوان، CI و … استفاده میکنند و کمتر با این مشکلات مواجه می‌شوند. امیدوارم برای شما پیش نیاد. این مقاله یک بحث فنی در مورد گیت است و در مورد یکی از امکاناتش برای یافتن کامیت مشکل دار در بین انبوهی از کامیت ها. git bisect " /><meta name="twitter:card" content="summary" /><meta name="twitter:description" content="وقتی پروژه، محصول و تیم ها رشد می‌کنند، به همون اندازه پیدا کردن مشکلات و خطاهای کدها سخت تر میشه. تا جایی که بعضا دیده شده باگ هایی سهمگین موجب حملات قلبی عروقی سازمان‌یافته به مسئولین سالم نگه‌داشتن پروژه شده است. احتمالا چیزی نزدیک به همه تیم هایی که می‌شود ارزش سر آنها را بر تنشان سنجید، از مکانیزم های کنترلی، تست های فراوان، CI و … استفاده میکنند و کمتر با این مشکلات مواجه می‌شوند. امیدوارم برای شما پیش نیاد. این مقاله یک بحث فنی در مورد گیت است و در مورد یکی از امکاناتش برای یافتن کامیت مشکل دار در بین انبوهی از کامیت ها. git bisect " /><meta name="author" content="پول ریکوئست به قلم nima" /><meta property="og:title" content="اتوماتیک گیت بای سکت یا چگونه با دو نیم کردن اتوماتیک از سکته جلوگیری کنیم" /><meta property="twitter:title" content="اتوماتیک گیت بای سکت یا چگونه با دو نیم کردن اتوماتیک از سکته جلوگیری کنیم" /><link rel="stylesheet" type="text/css" href="/style.css" /><link rel="alternate" type="application/rss+xml" title="پول ریکوئست - پول ریکوئست، دست نوشته های فنی فارسی زبان" href="/feed.xml" /> <script src="/pr.js"></script><body><div class="site__container"><header class="site__header container"><figure class="site__header__brand"> <a href="http://pullrequest.ir"> <img src="/assets/images/pr.svg" alt="PR"> </a></figure><nav class="site__header__nav"><ul class="list--unstyled list--inline header__list text--center"><li> <a href="/about">پول ریکوئست چیست</a><li> <a href="/pr-authors">نویسندگان</a><li> <a href="/contribute">راهنمای انتشار مطالب در پول ریکوئست</a></ul></nav></header><hr class="site__header__divider container" /><main role="main" class="container"><article class="post post--single"><h1 class="post__title post__title--single">اتوماتیک گیت بای سکت یا چگونه با دو نیم کردن اتوماتیک از سکته جلوگیری کنیم</h1><div class="post__info"> <span> <span class="lazyimage"> <img onload="window.pr.methods.addClass('img-loaded', this.parentNode)" onerror="window.pr.methods.addClass('img-error', this)" src="/assets/images/nima.jpeg" alt="نیما هاشمی" class="img-rounded post__info__figure inline--middle" > </span> <span class="inline--middle post__author"><a href="http://pullrequest.ir/authors/nima">نیما هاشمی</a></span> </span> <small><em>1396-2-11</em></small></div><div class="post__share text--left"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/%DA%AF%DB%8C%D8%AA-%D8%A8%DB%8C%D8%B3%DA%A9%D9%88%DB%8C%DB%8C%D8%AA/&via=http://pullrequest.ir&text=اتوماتیک گیت بای سکت یا چگونه با دو نیم کردن اتوماتیک از سکته جلوگیری کنیم"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/%DA%AF%DB%8C%D8%AA-%D8%A8%DB%8C%D8%B3%DA%A9%D9%88%DB%8C%DB%8C%D8%AA/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul><nav class="post__tags post__tags--single"> <i class="icon pricon-tag"></i><ul class="list--unstyled list--inline"><li><a href="/tag/git">#git</a><li><a href="/tag/bisect">#bisect</a><li><a href="/tag/سکته">#سکته</a><li><a href="/tag/disaster">#disaster</a></ul></nav></div><div class="post__entry post__entry--single"><p>وقتی پروژه، محصول و تیم ها رشد می‌کنند، به همون اندازه پیدا کردن مشکلات و خطاهای کدها سخت تر میشه. تا جایی که بعضا دیده شده باگ هایی سهمگین موجب حملات قلبی عروقی سازمان‌یافته به مسئولین سالم نگه‌داشتن پروژه شده است. احتمالا چیزی نزدیک به همه تیم هایی که می‌شود ارزش سر آنها را بر تنشان سنجید، از مکانیزم های کنترلی، تست های فراوان، CI و … استفاده میکنند و کمتر با این مشکلات مواجه می‌شوند. امیدوارم برای شما پیش نیاد. این مقاله یک بحث فنی در مورد گیت است و در مورد یکی از امکاناتش برای یافتن کامیت مشکل دار در بین انبوهی از کامیت ها. <code class="highlighter-rouge">git bisect</code><p>تصور کنین یک merge عظیم داشتید و بعد از صدها کامیتِ اعضای مختلف تیم، بیلد شما Fail بشه.<p>(خوش بینانه اگه از CI استفاده میکنید فکر میکنم نمیذارید کار به اینجا برسه و واقعا پروسه کاری شما continuos هست. اصولا تو یه تیم منظم که دائم چند بار در روز پوش و مرج میکنن خیلی این اتفاق نادره ولی همیشه همه چیز منظم پیش نمیره. این بحث که در شرایط عادی و آروم این اتفاق نمیفته و نباید بیفته کاملا درسته ولی دونستن این روش ممکنه یک روز نجاتتون بده)<p>ممکنه پیدا کردن کامیت با بررسی تک تک اون ها از بالا(!) اولین راهی باشه که به ذهن شما برسه. این یک سرچ خطیه و احتمالا میدونید هزینه یک سرچ خطی چقدر بالاست خصوصا توسط یک انسان که باید یک باگ رو پیدا کنه. اگه تو علوم کامپیوتر و الگوریتم دستی داشته باشید باید حدس زده باشید که راه حل یک سرچ باینریه.<p>حتما میدونید که سرچ باینری تو یه مجموعه با هر بار نصف کردن مجموعه و مقایسه جستجو رو محدود تر میکنه تا اینکه با چند پرش به نقطه مورد نظر برسه. چقدر خوب. شما به جای بررسی ۲۰۰ تا کامیت اگه اون ها رو باینری بگردید میتونید با مثلا هفت هشت پرش کامیت مورد نظرتون رو پیدا کنید. شما واقعا تو این حالت نمیدونید کامیت مشکل دار سَرِ هیستوریه یا تهش.<p>خب این ایده قبلا به فکر توسعه دهنده های گیت رسیده و ابزاری رو برای گشتن لابلای کامیت ها توسعه دادند به نام <code class="highlighter-rouge">git bisect</code> که کارش دقیقا همینه. ساده ترین نوع استفاده از این ابزار به صورت دستی به ترتیب زیره.<p>گیت bisect رو شروع کنید<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># git bisect start
</code></pre></div></div><p>یه revision بد (خراب، شکسته، معیوب، باگی، گیت بهش میگه بد) معرفی کنید. مثلا HEAD<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># git bisect bad {your bad revision}
</code></pre></div></div><p>یک revision سالم معرفی کنید (مثلا آخرین کامیتی که تو مستر قبل از مرج وجود داشت یا تگ ریلیز قبلی)<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># git bisect good {your good revision}
</code></pre></div></div><p>حلقه bisect شروع میشه. حالا گیت میره به یک کامیت که از طریق باینری سرچ نوبتش شده باشه. شما میتونید اینجا اون کامیت رو تست و بیلد کنید ببینید تا اینجای اوضاع چطوره. بعدش به گیت بگید که مشکل هنوز وجود داره یا نه. با این کامند ها<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># git bisect good
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># git bisect bad
</code></pre></div></div><p>گیت مجددا تو بازه محدودتری سرچ میکنه و با راهنمایی شما کامیت مورد دار رو پیدا میکنه و نشونتون میده! اینجا با یه <code class="highlighter-rouge">git show {commit ref}</code> شما اون کامیت رو بررسی میکنین و مشکل رو حل میکنین. به همین سادگی و مجیکالی!<p>خب اینجا اگه کد های شما چیز قابل ارائه تو کنسول باشه مثلا خروجی یه build یا unit test میشه این فرآیند رو automate کرد. امیدوارم تست هاتون پوشش (coverage) قابل اتکایی داشته باشن. اصولا bisect نیاز به یه کاوریج خیلی خوب داره.<h2 id="سکته-یاب-دو-نیم-کننده-اتوماتیک">سکته یاب دو نیم کننده اتوماتیک</h2><p>برای اتومِیت کردن این فرایند شما به یک اسکریپت احتیاج دارید که بیلد و تست شما رو انجام بده.<p>برای شرح ساده ترین حالت فرض کنید من با node.js یک اپلیکیشن نوشتم که با استفاده از npm و این کامند اون رو تست می‌کنم:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm test
</code></pre></div></div><p>و تسک رانر npm مثلا برای من تست های mocha رو اجرا میکنه و خروجی اون رو تو ترمینال نشون میده. یه مشت خروجی که اگه توش کلمه Failed وجود داشته باشه یعنی تست ناموفق بود و اگه نه هم که تست موفقه. این اسکریپت یه حالت خیلی سادست. بعد از اون شما باید با Shell exit code ها آشنا باشید که بتونید از اون ها استفاده کنید. ساده ترین حالت اون exit کد <code class="highlighter-rouge">0</code> هست که به معنی موفقیت اسکریپت بیلد یا تست شماست و هر کد دیگه ای نشون دهنده ی خطا. من با گِرِپ کردن خروجی npm test خودم و گشتن دنبال کلمه fail به اسکریپت میفهمونم که تست موفق بوده یا نه. شما میتونید از هر مکانیزم و روشی برای این کار استفاده کنید. کد نمونه چیزی شبیه اینه:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‍‍‍‍‍‍#!/usr/bin/env bash 

# Build and grep for failure output. Replace with your own command. 
npm test 2&gt;&amp;1 | grep 'failed' 

# Retrieve the exit code of the grep. 
if [ "$?" -eq "0" ]; then 
  #echo "Fail found." 
  exit 1 
else 
  #echo "Fail not found." 
  exit 0 
fi 
</code></pre></div></div><p>بعد از نوشتن لاجیک تست خودتون، از این کامند استفاده کنید:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  # git bisect start {bad revision} {good revision}
  # git bisect run {path to your script}
</code></pre></div></div><p>گیت هر بار اسکریپت شما رو ران میکنه و با توجه به اون نتیجه براتون کامیت مشکل دار رو پیدا می‌کنه.<p>احتمالا راه های ساده تری برای استفاده از git bisect تو چرخه CI خودتون وجود داره. اگه فکر میکنید چیزی نیازه در تکمیل این متن یا در ادامه منتشر بشه، حتما برای ما PR بفرستید!</div><div class="post__share text--center"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/%DA%AF%DB%8C%D8%AA-%D8%A8%DB%8C%D8%B3%DA%A9%D9%88%DB%8C%DB%8C%D8%AA/&via=http://pullrequest.ir&text=اتوماتیک گیت بای سکت یا چگونه با دو نیم کردن اتوماتیک از سکته جلوگیری کنیم"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/%DA%AF%DB%8C%D8%AA-%D8%A8%DB%8C%D8%B3%DA%A9%D9%88%DB%8C%DB%8C%D8%AA/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul></div><script> window.pr.methods.docReady(function() { var singleEntry = window.pr.methods.selectElementByClassName('.post__entry--single'); var excerptEntry = window.pr.methods.selectElementByClassName('.post__excerpt'); if (singleEntry) window.pr.methods.parseTextForEmojis(singleEntry); else if (excerptEntry) window.pr.methods.parseTextForEmojis(excerptEntry); }) </script><hr /><div class="comments"><div id="disqus_thread"></div><script async defer src='https://pwl-rykhwyst.disqus.com/embed.js' onerror="disqusHandler();"></script> <script type="text/javascript"> var disqusHandler = (function (w) { var methods = w.pr.methods; /* methods.docReady(function () { loadDisqusScript() }); function loadDisqusScript() { methods.getAjax('https://pwl-rykhwyst.disqus.com/embed.js', null, function (e) { addDisqusErrorIfNotPresent(); // Parse any emoji inside error methods.parseTextForEmojis(document.getElementById('comment__error')); }) } */ function addDisqusErrorIfNotPresent() { var comments = methods.selectElementByClassName('.comments'); /* Add only for the 1st time */ if (!methods.selectElementById('comment__error')) { /* Add error to .comments */ comments.appendChild(createDisqusError()); /* Parse any emoji inside error */ methods.parseTextForEmojis(document.getElementById('comment__error')); } } function createDisqusError() { var err = document.createElement('div'); err.id = 'comment__error'; window.pr.methods.addClass('alert', err); err.innerHTML = 'اگر این پیام رو میبینین، به این معنیه که اسکریپت Disqus براتون لود نشده. سرویس Disqus توی ایران فیلتر شده!! <strong>لطفا وی پی ان تون رو روشن کنین و صفحه فعلی رو ریفرش کنین.</strong> :پی'; return err; } return addDisqusErrorIfNotPresent; })(window); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></article></div><footer class="site__footer clearfix"><div class="site__footer__brand" onclick="window.pr.methods.goToTop()"> <img class="img-block" src="/assets/images/pr.svg" alt="PR"></div><div class="container clearfix"><nav class="pull-right site__footer__menu"><ul class="list--unstyled list--inline site__footer__list"><li> <a target="_blank" href="https://github.com/pr-techblog"> <i class="icon pricon-github"></i> گیتهاب </a><li> <a target="_blank" href="https://twitter.com/pr_techblog"> <i class="icon pricon-twitter"></i> توییتر </a></ul></nav><div class="pull-left text--ltr site__footer__copyright">Made with ❦ @ <strong>PullRequest</strong></div></div></footer></div><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93910742-1', 'auto'); ga('send', 'pageview', { 'page': '/%DA%AF%DB%8C%D8%AA-%D8%A8%DB%8C%D8%B3%DA%A9%D9%88%DB%8C%DB%8C%D8%AA/', 'title': 'اتوماتیک گیت بای سکت یا چگونه با دو نیم کردن اتوماتیک از سکته جلوگیری کنیم' }); </script>
