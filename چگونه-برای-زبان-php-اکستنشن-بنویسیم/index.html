<!DOCTYPE html><html><head><title>چگونه برای زبان PHP اکستنشن بنویسم؟</title><meta charset="utf-8" /><meta content='text/html; charset=utf-8' http-equiv='Content-Type'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'><meta property="og:locale" content="fa_IR" /><meta property="og:site_name" content="پول ریکوئست" /><meta name="twitter:image" content="/assets/images/pr.svg" /><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="theme-color" content="#000"><meta property="og:type" content="article" /><meta name="description" content="خیلی باحاله، وقتی ما میتونیم برای زبانی که داخلش برنامه نویسی میکردیم هم اکستنشن بنویسیم و این بهمون علاوه برخیلی از امکانات وامتیازات فنی یه حس قدرت میده که بتونیم برای php اکستنشن بنویسم. " /><meta property="og:description" content="خیلی باحاله، وقتی ما میتونیم برای زبانی که داخلش برنامه نویسی میکردیم هم اکستنشن بنویسیم و این بهمون علاوه برخیلی از امکانات وامتیازات فنی یه حس قدرت میده که بتونیم برای php اکستنشن بنویسم. " /><meta name="twitter:card" content="summary" /><meta name="twitter:description" content="خیلی باحاله، وقتی ما میتونیم برای زبانی که داخلش برنامه نویسی میکردیم هم اکستنشن بنویسیم و این بهمون علاوه برخیلی از امکانات وامتیازات فنی یه حس قدرت میده که بتونیم برای php اکستنشن بنویسم. " /><meta name="author" content="پول ریکوئست به قلم mahmoud" /><meta property="og:title" content="چگونه برای زبان PHP اکستنشن بنویسم؟" /><meta property="twitter:title" content="چگونه برای زبان PHP اکستنشن بنویسم؟" /><link rel="stylesheet" type="text/css" href="/style.css" /><link rel="alternate" type="application/rss+xml" title="پول ریکوئست - پول ریکوئست، دست نوشته های فنی فارسی زبان" href="/feed.xml" /> <script src="/pr.js"></script><body><div class="site__container"><header class="site__header container"><figure class="site__header__brand"> <a href="http://pullrequest.ir"> <img src="/assets/images/pr.svg" alt="PR"> </a></figure><nav class="site__header__nav"><ul class="list--unstyled list--inline header__list text--center"><li> <a href="/about">پول ریکوئست چیست</a><li> <a href="/pr-authors">نویسندگان</a><li> <a href="/contribute">راهنمای انتشار مطالب در پول ریکوئست</a></ul></nav></header><hr class="site__header__divider container" /><main role="main" class="container"><article class="post post--single"><h1 class="post__title post__title--single">چگونه برای زبان PHP اکستنشن بنویسم؟</h1><div class="post__info"> <span> <span class="lazyimage"> <img onload="window.pr.methods.addClass('img-loaded', this.parentNode)" onerror="window.pr.methods.addClass('img-error', this)" src="/assets/images/mahmoud.jpg" alt="محمود اسکندری" class="img-rounded post__info__figure inline--middle" > </span> <span class="inline--middle post__author"><a href="http://pullrequest.ir/authors/mahmoud">محمود اسکندری</a></span> </span> <small><em>1396-8-27</em></small></div><div class="post__share text--left"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/%DA%86%DA%AF%D9%88%D9%86%D9%87-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%B2%D8%A8%D8%A7%D9%86-php-%D8%A7%DA%A9%D8%B3%D8%AA%D9%86%D8%B4%D9%86-%D8%A8%D9%86%D9%88%DB%8C%D8%B3%DB%8C%D9%85/&via=http://pullrequest.ir&text=چگونه برای زبان PHP اکستنشن بنویسم؟"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/%DA%86%DA%AF%D9%88%D9%86%D9%87-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%B2%D8%A8%D8%A7%D9%86-php-%D8%A7%DA%A9%D8%B3%D8%AA%D9%86%D8%B4%D9%86-%D8%A8%D9%86%D9%88%DB%8C%D8%B3%DB%8C%D9%85/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul><nav class="post__tags post__tags--single"> <i class="icon pricon-tag"></i><ul class="list--unstyled list--inline"><li><a href="/tag/php">#php</a><li><a href="/tag/zephir">#zephir</a><li><a href="/tag/پی">#پی</a><li><a href="/tag/اچ">#اچ</a><li><a href="/tag/پی">#پی</a><li><a href="/tag/اکستنشن">#اکستنشن</a></ul></nav></div><div class="post__entry post__entry--single"><p>خیلی باحاله، وقتی ما میتونیم برای زبانی که داخلش برنامه نویسی میکردیم هم اکستنشن بنویسیم و این بهمون علاوه برخیلی از امکانات وامتیازات فنی یه حس قدرت میده که بتونیم برای php اکستنشن بنویسم.<p>برای نوشتن اکستنشن در php یه راه قدیمی و سخت هست که از آشنایی با zend-engine میگذره و همچنین برنامه نویسی به زبان C که یه کم دنگ و فنگ داره و ممکنه حتی خیلی از تازه کارها از این کار منصرف بشن! اما راهی که میخوام در ادامه بگم زبان <a href="https://zephir-lang.com">Zephir</a> هستش که به آسونی میتونید باهاش آشنا بشید و فلسفه ی ساختن این زبان آسون کردن ساخت اکستنشن برای برنامه نویسانphp هستش و تا حد زیادی توابع و سینتکس این زبان شبیه به خود php بامزه ی ماست!<p>شمای کلی کارش هم به صورت زیره<p><img src="https://image.ibb.co/gqghQ6/scheme.png" alt="Architect" title="Architect" /><p>برنامه نوشته شده به زبان zephir شما پس از بررسی و بهینه سازی به یک اکستنشن C برای php تبدیل میشه و بعد از اون هم به یک اکستنشن بومی یا همون نیتیو خودمون تبدیل میشه.<h1 id="نصب-کامپایلر">نصب کامپایلر</h1><p>از اونجایی که گیک ها روی لینوکس کار میکنند پس راه نصب zephir رو روی لینوکس که از سایت مرجع عیناً برداشتم رو اینجا میذارم. میتونید از بخش <a href="https://docs.zephir-lang.com/en/latest/install.html">Installation</a> کمک بگیرید و پیش نیازها رو نصب کنید، و در ویندوز هم میتونید با یه مشقتی سر کانفیگ کردن ویژوال استودیو خروجی بگیرید.<p>پیشنیازهای سیستم:<ul><li>gcc &gt;= 4.x/clang &gt;= 3.x<li>re2c 0.13 or later<li>gnu make 3.81 or later<li>autoconf 2.31 or later<li>automake 1.14 or later<li>libpcre3<li>php development headers and tools <br /> نترسید! اینا کلاً چیز خاصی نیستن و اگر مثلا از ابونتوی آخرین نسخه استفاده میکنید اکثرش رو خواهید داشت. اول به سیستم یه آپدیت میدیم تا حالش جا بیاد که مشکلی برامون ایجاد نکنه سر برنامه های قدیمیش و Repoهاش هم به روز بشه!</ul><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get update
</code></pre></div></div><p><em>نکته! همین دستورات رو در توزیع های Redhat مثل CentOs میتونید بزنید کافیه که به جای apt-get از دستور yum استفاده کنید.</em><p>خوب حالا بسته به ورژنphpتون که من اینجا 7.0 رو دارم کامپایلر زبان و پیشنیازهاش رو نصب میکنیم.<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ sudo apt-get install git gcc make php7.0 php7.0-json php7.0-dev libpcre3-dev re2c
</code></pre></div></div><p><em>البته اینو تذکر بدم که قبلش باید php رو روی سیستمتون داشته باشید این دستورات مربوط به نصب صرفاً رفقای زِفیر هستش</em><p>بعد از نصب پیشنیازها حالا نوبت به کلون کردن زفیر از گیتهاب هستش:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/phalcon/zephir
</code></pre></div></div><p>بعدشم که باید کامپایلر رو از روی سورسش نصب کنید. با دستور اول وارد پوشه ی سورس کامپایلر میشید و با دستور بعدی میگیم بهش که نصب شو!<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd zephir
$ ./install -c
</code></pre></div></div><p>امیدوارم هیچ ارور زبون نفهمی ندیده باشید و این مراحل رو به آسونی پشت سر گذاشته باشید. حالا چک کنیم ببینیم زفیر نصب شده!<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zephir help
</code></pre></div></div><p>خوب اگر راهنمای استفاده چاپ شد که بهتون تبریک میگم شما الان یه اکستشن نویس زبان محبوبphp هستی :)<p>در ضمن اگر از Docker استفاده میکنید میتونید به راحتی از <a href="https://hub.docker.com/r/phalconphp/zephir/">اینجا</a> داکیومنت ایمیجش رو ببینید و یا با دستور زیر پول کنید:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull phalconphp/zephir
</code></pre></div></div><h1 id="آشنایی-اولیه-با-سینتکس-و-ساخت-یه-پروژه-ی-نمونه-یا-همون-hello-world">آشنایی اولیه با سینتکس و ساخت یه پروژه ی نمونه یا همون Hello World:</h1><p>تفاوت عمده ی زفیر با php در نگارش چندتا چیز ساده است:<p>1) تعریف متغیر قبل از استفاده از اون، یعنی اگر میخوایم از متغیر <code class="highlighter-rouge">i</code> استفاده کنیم باید ازقبل مثلاً به صورت <code class="highlighter-rouge">int i;</code> تعریفش کنیم.<p>2) موقع مقدار دهی به متغیرها باید از <code class="highlighter-rouge">let</code> استفاده کنیم، یعنی اگر متغیر <code class="highlighter-rouge">i</code> رو بخوایم برابر 0 قرار بدیم باید بنویسیم <code class="highlighter-rouge">let i =0;</code><p>3) موقع تعریف متغیرها دیگه خبری از دلار <code class="highlighter-rouge">$</code> معروف نیست و باید به رسم C نامگذاریها رو انجام بدید<p>4) اگر متغیری رو تعریف کنیم و ازش استفاده نکنیم کامپایلر بهمون اخطار میده<p>5) فایلهای این زبان برنامه نویسی با پسوند <code class="highlighter-rouge">.zep</code> ذخیره میشن!<p><em>البته که تفاوتهای دیگه ای هم هست ولی موارد بالا اصلی ترین اختلافات هست و برای مطالعه ی بیشتر به سایت اصلیش برید!</em><h2 id="برنامه-hello-world">برنامه hello world</h2><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zephir init Test
$ cd Test
</code></pre></div></div><p>دستور بالا رو اجرا میکنیم تا فایلهای ابتدایی یه پروژه ایجاد بشن و اون Test که نوشتیم اسم فضای برنامه است و هر اسمی میتونه باشه! بعدش که فولدر برنامه رو با این دستور ساختید به همین نام فضای برنامه یه پوشه داخل اون هست یعنی <code class="highlighter-rouge">Test/Test</code> برای این مثالی که زدم. بعدش یه فایل همنام کلاسی که میخوام بسازم در اینجا <code class="highlighter-rouge">hello.zep</code> و داخلش مینویسیم:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>namespace Test;
class Hello
{
    public static function say()
    {
        echo "Hello World!";
    }
}
</code></pre></div></div><p>تو یه پوشه بالاتر از این یعنی همون فولدر اصلی اکستنشن یه فایل هست به نام <code class="highlighter-rouge">config.json</code> اگر برنامتون نیاز به اکستنشن خاصی داره و یا دوست دارید تنظیماتش رو عوض کنید میتونید بازش کنید و تغییرش بدید.<h2 id="کامپایل-برنامه">کامپایل برنامه</h2><p>در پوشه ی ریشه اکستنش کافیه این کامند رو بزنید:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ zephir build
</code></pre></div></div><p>و صبر کنید تا کامپایل اکستنشن تموم بشه، وقتی که تموم شد یه فایل با نام <code class="highlighter-rouge">test.so</code> داخل فولدر اکستنشهای php میسازه که اگر نمیدونید کجاست میتونید داخل <code class="highlighter-rouge">phpinfo();</code> دنبال کافیگ <code class="highlighter-rouge">extension_dir</code> بگردید.( اگر نمیخواید فایل خروجی رو کپی کنید مهم نیست بدونید اون فایل کجا ریخته میشه!) ولی باید فایل <code class="highlighter-rouge">php.ini</code> رو باز کنید و( تهش یا قسمتی که مربوط به اکستنشن هاست برای اینکه بعدا نخواهید دنبال چیزی بگردید )باید اکستنشنی که بیلد کردید رو اعلام کنید.<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extension=test.so
</code></pre></div></div><p>بعد از اینکه سیو کردید نوبت اینه اگر لازمه وبسرورتون رو ریستارت کنید تا تغییرات اعمال بشه. تمام مراحلی که در این قسمت گفته شد فقط برای اولین دفعه ای که اکستنشن رو تعریف میکنید لازمه به جز ریستارت کردن وبسرور که باید بعد از هر بار بیلد اعمال بشه و اگر یه گیک باشید میدونید که با یه <code class="highlighter-rouge">bash</code> هر دو دستور رو با هم ران کنید :)<p>بعد از بیلد کردن و تعریف اکستنشنمون برای php حالا وقتشه بریم و از ران کردنش لذت ببریم. یه فایل <code class="highlighter-rouge">php</code> بسازید و داخلش بنویسید:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">echo</span> <span class="nx">Test\Hello</span><span class="o">::</span><span class="na">say</span><span class="p">();</span> <span class="c1">//Hello World</span>

<span class="cp">?&gt;</span>
</code></pre></div></div><p>اون کلاسهایی که در اکستنشن نوشتید همه جا در دسترس هستش و بدون استفاده از <code class="highlighter-rouge">autoloader</code> یا… در همه جای برنامه کار میکنه!<p>زفیر برای این ابداع نشده که جای C یا php رو بگیره بلکه اومده تلفیقی از مزایای این دو رو ارائه بده، فریم ورک <a href="https://phalconphp.com/en/">Phalconphp</a> این زبان رو برای توسعه فریم ورکش ساخته که کل فریم ورک فالکن به صورت کامپایل شده هست از سرعت و امکانات خوبی برخوردار هستش، که طبق یه سری تستهای نه چندان تخصصی خودم با ابزار <code class="highlighter-rouge">apache abs </code>تا 20 برابر سرعت بالاتری نسبت به فریم ورکی مثل لاراول داشت!<p><strong>مزایای Zephir:</strong><ul><li>افزایش سرعت اجرای برنامه ، اما نه در مواقعی که الگوریتم نیاز به IO یا Memory زیاد داره!<li>کامپایل شدن که درنهایت باعث مخفی شدن کدهای شما خواهد شد بدون نیاز به انکد کردن کدها و دردسرهای ناشی از اونها</ul><p>امیدوارم براتون مفید باشه منتظر فیدبک های شما هستم</div><div class="post__share text--center"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/%DA%86%DA%AF%D9%88%D9%86%D9%87-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%B2%D8%A8%D8%A7%D9%86-php-%D8%A7%DA%A9%D8%B3%D8%AA%D9%86%D8%B4%D9%86-%D8%A8%D9%86%D9%88%DB%8C%D8%B3%DB%8C%D9%85/&via=http://pullrequest.ir&text=چگونه برای زبان PHP اکستنشن بنویسم؟"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/%DA%86%DA%AF%D9%88%D9%86%D9%87-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%B2%D8%A8%D8%A7%D9%86-php-%D8%A7%DA%A9%D8%B3%D8%AA%D9%86%D8%B4%D9%86-%D8%A8%D9%86%D9%88%DB%8C%D8%B3%DB%8C%D9%85/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul></div><script> window.pr.methods.docReady(function() { var singleEntry = window.pr.methods.selectElementByClassName('.post__entry--single'); var excerptEntry = window.pr.methods.selectElementByClassName('.post__excerpt'); if (singleEntry) window.pr.methods.parseTextForEmojis(singleEntry); else if (excerptEntry) window.pr.methods.parseTextForEmojis(excerptEntry); }) </script><hr /><div class="comments"><div id="disqus_thread"></div><script async defer src='https://pwl-rykhwyst.disqus.com/embed.js' onerror="disqusHandler();"></script> <script type="text/javascript"> var disqusHandler = (function (w) { var methods = w.pr.methods; /* methods.docReady(function () { loadDisqusScript() }); function loadDisqusScript() { methods.getAjax('https://pwl-rykhwyst.disqus.com/embed.js', null, function (e) { addDisqusErrorIfNotPresent(); // Parse any emoji inside error methods.parseTextForEmojis(document.getElementById('comment__error')); }) } */ function addDisqusErrorIfNotPresent() { var comments = methods.selectElementByClassName('.comments'); /* Add only for the 1st time */ if (!methods.selectElementById('comment__error')) { /* Add error to .comments */ comments.appendChild(createDisqusError()); /* Parse any emoji inside error */ methods.parseTextForEmojis(document.getElementById('comment__error')); } } function createDisqusError() { var err = document.createElement('div'); err.id = 'comment__error'; window.pr.methods.addClass('alert', err); err.innerHTML = 'اگر این پیام رو میبینین، به این معنیه که اسکریپت Disqus براتون لود نشده. سرویس Disqus توی ایران فیلتر شده!! <strong>لطفا وی پی ان تون رو روشن کنین و صفحه فعلی رو ریفرش کنین.</strong> :پی'; return err; } return addDisqusErrorIfNotPresent; })(window); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></article></div><footer class="site__footer clearfix"><div class="site__footer__brand" onclick="window.pr.methods.goToTop()"> <img class="img-block" src="/assets/images/pr.svg" alt="PR"></div><div class="container clearfix"><nav class="pull-right site__footer__menu"><ul class="list--unstyled list--inline site__footer__list"><li> <a target="_blank" href="https://github.com/pr-techblog"> <i class="icon pricon-github"></i> گیتهاب </a><li> <a target="_blank" href="https://twitter.com/pr_techblog"> <i class="icon pricon-twitter"></i> توییتر </a></ul></nav><div class="pull-left text--ltr site__footer__copyright">Made with ❦ @ <strong>PullRequest</strong></div></div></footer></div><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93910742-1', 'auto'); ga('send', 'pageview', { 'page': '/%DA%86%DA%AF%D9%88%D9%86%D9%87-%D8%A8%D8%B1%D8%A7%DB%8C-%D8%B2%D8%A8%D8%A7%D9%86-php-%D8%A7%DA%A9%D8%B3%D8%AA%D9%86%D8%B4%D9%86-%D8%A8%D9%86%D9%88%DB%8C%D8%B3%DB%8C%D9%85/', 'title': 'چگونه برای زبان PHP اکستنشن بنویسم؟' }); </script>
