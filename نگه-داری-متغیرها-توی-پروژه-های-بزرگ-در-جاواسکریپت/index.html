<!DOCTYPE html><html><head><title>نگه‌داری متغیرها توی پروژه‌های بزرگ در جاواسکریپت</title><meta charset="utf-8" /><meta content='text/html; charset=utf-8' http-equiv='Content-Type'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'><meta property="og:locale" content="fa_IR" /><meta property="og:site_name" content="پول ریکوئست" /><meta name="twitter:image" content="/assets/images/pr.svg" /><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="theme-color" content="#000"><meta property="og:type" content="article" /><meta name="description" content="اگر با جاواسکریپت و فریم‌ورک‌هایی مثل ری‌اکت، انگولار، ویو یا دوستای اون‌ها برنامه می‌نویسید و بطور کلی مفهوم کامپوننت رو می‌دونید، این متن برای شماست. من قرار نیست توی این پست Redux و Vuex یا هر لایبرری دیگه رو یاد بدم، بلکه می‌خوام توضیح بدم این‌هایی که گفتم چه کار می‌کنن و طرز کار کلیشون چجوریه. " /><meta property="og:description" content="اگر با جاواسکریپت و فریم‌ورک‌هایی مثل ری‌اکت، انگولار، ویو یا دوستای اون‌ها برنامه می‌نویسید و بطور کلی مفهوم کامپوننت رو می‌دونید، این متن برای شماست. من قرار نیست توی این پست Redux و Vuex یا هر لایبرری دیگه رو یاد بدم، بلکه می‌خوام توضیح بدم این‌هایی که گفتم چه کار می‌کنن و طرز کار کلیشون چجوریه. " /><meta name="twitter:card" content="summary" /><meta name="twitter:description" content="اگر با جاواسکریپت و فریم‌ورک‌هایی مثل ری‌اکت، انگولار، ویو یا دوستای اون‌ها برنامه می‌نویسید و بطور کلی مفهوم کامپوننت رو می‌دونید، این متن برای شماست. من قرار نیست توی این پست Redux و Vuex یا هر لایبرری دیگه رو یاد بدم، بلکه می‌خوام توضیح بدم این‌هایی که گفتم چه کار می‌کنن و طرز کار کلیشون چجوریه. " /><meta name="author" content="پول ریکوئست به قلم amir" /><meta property="og:title" content="نگه‌داری متغیرها توی پروژه‌های بزرگ در جاواسکریپت" /><meta property="twitter:title" content="نگه‌داری متغیرها توی پروژه‌های بزرگ در جاواسکریپت" /><link rel="stylesheet" type="text/css" href="/style.css" /><link rel="alternate" type="application/rss+xml" title="پول ریکوئست - پول ریکوئست، دست نوشته های فنی فارسی زبان" href="/feed.xml" /> <script src="/pr.js"></script><body><div class="site__container"><header class="site__header container"><figure class="site__header__brand"> <a href="http://pullrequest.ir"> <img src="/assets/images/pr.svg" alt="PR"> </a></figure><nav class="site__header__nav"><ul class="list--unstyled list--inline header__list text--center"><li> <a href="/about">پول ریکوئست چیست</a><li> <a href="/pr-authors">نویسندگان</a><li> <a href="/contribute">راهنمای انتشار مطالب در پول ریکوئست</a></ul></nav></header><hr class="site__header__divider container" /><main role="main" class="container"><article class="post post--single"><h1 class="post__title post__title--single">نگه‌داری متغیرها توی پروژه‌های بزرگ در جاواسکریپت</h1><div class="post__info"> <span> <span class="lazyimage"> <img onload="window.pr.methods.addClass('img-loaded', this.parentNode)" onerror="window.pr.methods.addClass('img-error', this)" src="/assets/images/amir.png" alt="امیر مومنیان" class="img-rounded post__info__figure inline--middle" > </span> <span class="inline--middle post__author"><a href="http://pullrequest.ir/authors/amir">امیر مومنیان</a></span> </span> <small><em>1396-1-18</em></small></div><div class="post__share text--left"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/%D9%86%DA%AF%D9%87-%D8%AF%D8%A7%D8%B1%DB%8C-%D9%85%D8%AA%D8%BA%DB%8C%D8%B1%D9%87%D8%A7-%D8%AA%D9%88%DB%8C-%D9%BE%D8%B1%D9%88%DA%98%D9%87-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D8%AC%D8%A7%D9%88%D8%A7%D8%B3%DA%A9%D8%B1%DB%8C%D9%BE%D8%AA/&via=http://pullrequest.ir&text=نگه‌داری متغیرها توی پروژه‌های بزرگ در جاواسکریپت"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/%D9%86%DA%AF%D9%87-%D8%AF%D8%A7%D8%B1%DB%8C-%D9%85%D8%AA%D8%BA%DB%8C%D8%B1%D9%87%D8%A7-%D8%AA%D9%88%DB%8C-%D9%BE%D8%B1%D9%88%DA%98%D9%87-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D8%AC%D8%A7%D9%88%D8%A7%D8%B3%DA%A9%D8%B1%DB%8C%D9%BE%D8%AA/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul><nav class="post__tags post__tags--single"> <i class="icon pricon-tag"></i><ul class="list--unstyled list--inline"><li><a href="/tag/javascript">#javascript</a><li><a href="/tag/state">#state</a><li><a href="/tag/component">#component</a></ul></nav></div><div class="post__entry post__entry--single"><p>اگر با جاواسکریپت و فریم‌ورک‌هایی مثل ری‌اکت، انگولار، ویو یا دوستای اون‌ها برنامه می‌نویسید و بطور کلی مفهوم کامپوننت رو می‌دونید، این متن برای شماست. من قرار نیست توی این پست <a href="https://github.com/reactjs/redux">Redux</a> و <a href="https://github.com/vuejs/vuex">Vuex</a> یا هر لایبرری دیگه رو یاد بدم، بلکه می‌خوام توضیح بدم این‌هایی که گفتم چه کار می‌کنن و طرز کار کلیشون چجوریه.<p>حتما می‌دونید که معمولا توی پترن برنامه‌نویسی کلاینت، ما سه تا بخش اصلی داریم. بخش اطلاعات یا همون state که اطلاعات ما رو نگه میداره. بخش actions که فانکشن‌های ما که قراره اطلاعات رو تغییر بده توش نگه‌داری میشه و بخش نمایش یا view که صفحاتی که کاربر قراره اونا رو ببینه و دکمه‌هاشون رو فشار بده، توی این بخش قرار می‌گیره. در ادامه، ارتباط این سه تا رو نشون می‌دم.<p><img src="https://www.dropbox.com/s/6dpq6av9wfeqoxo/flow.png?raw=1" alt="عکس" /><p>اگه اپلیکیشن ما در حد نمایش یه سری اطلاعات ساده و کم و زیاد کردن اعداد باشه، میتونیم با همین روند کارمون رو ادامه بدیم. چون این الگو ساده و قابل‌فهم برای شروعه و هیچ مشکل خاصی نداره. حتی ما می‌تونیم محاسبات پیچیده رو با همین الگو پیاده کنیم. اما وقتی اپلیکیشن ما بخواد بزرگ بشه، ممکنه ما اذیت بشیم. چرا؟ چون با گوشت‌کوب هم میشه میخ رو به دیوار کوبید، ولی اگه شما نجار باشی، برای ساختن یه صندلی بزرگ ممکنه بدون چکش دستتون رو زخم کنید. توی ادامه متن براتون توضیح میدم که چرا ممکنه دستمون زخم بشه.<p>فرض میکنیم برنامه ما یه برنامه‌ایه که کاربرها میتونن توش login کنن و یه سری دکمه رو بزنن و وقتی کارشون تموم شد، logout کنن. وقتی چندتا کامپوننت یا تمپلیت بخوان یه متغیر خاص مثلا وضعیت login کاربر رو نشون بدن و اتفاقا بعضی‌های دیگه‌شون بخوان اون رو تغییرش بدن، یکم اوضاع گوریده میشه به هم. درسته این کار شدنیه، ولی ما باید هی این متغیر رو به اون کامپوننت‌ها پاس بدیم. وقتی برنامه بزرگ باشه، ممکنه صاحب این متغیر خاص که گفتم، خود این کامپوننت لود شده نباشه و کامپوننت پدر که الان سه نسل با اون فاصله داریم صاحبش باشه. به عبارتی ما نمیتونیم به این نوه جدید بگیم متغیر وضعیت login رو تغییر بده، باید بگیم من دات پدرم دات پدرش دات متغیر وضعیت login رو تغییر بده. بعد تازه چون این متغیر خاص بین همه اونها مشترکه، وقتی یکیشون تغییر ایجاد میکنه بقیشون هم باید خبردار بشن و مشتقات این تغییر رو روی خودشون اعمال کنن. حالا تصور کنید خدا عمر با عزت به این فامیل عطا کنه و دارای هفت هشت تا نسل بشه. اون وقت آدرس‌دادن و مدیریت کردن تغییرات این متغیر بین کامپوننت‌ها پیچیده، سنگین و گیج کننده میشه. دیگه نگم که دخترعمو/پسرعموها هم بخوان با هم ازدواج کنن! این جوری اپلیکیشن ما میشه یه سالن کوچیک که هزارتا آدم دارن توش همدیگه رو صدا میکنن و هی با همدیگه کار دارن و کلی بچه هم اون وسط دارن کله‌ملق بازی می‌کنن.<h2 id="راه-حل-چیه">راه حل چیه؟</h2><p>ما میتونیم تصاحب این متغیرها رو از روی دوش کامپوننت‌ها برداریم و اونها رو توی یه آبجکت عمومی global نگه‌داری کنیم. اینطوری همشون اون رو میشناسنش و دیگه مشکل گوریدن نداریم. اما صبر کنید. اگه مثلا یه متغیر بخواد فقط تحت تصاحب خونواده خاله و نوه نتیجه اونها باشه و بقیه حق دخالت نداشته باشن چی؟ برای حل این یکی ما می‌تونیم از namespace یا آبجکت‌های من درآوردی دیگه یا ماژولار کردن اونها استفاده کنیم و حق تغییر و استفاده از اون‌ها رو به کامپوننت‌هامون بسپریم. جوری که متغیرها توی هم قاطی نشن. اما دوباره یه مشکل پیش میاد. بحث اختراع دوباره چرخ. اگه شما از دسته مخترعین عزیز هستین و دوست دارین این مشکل رو با روش‌های خودتون حل کنید، حق تصمیم‌گیری با شماست. ولی زمانی که بیشتر از یک نفر بخوان توی توسعه این برنامه شرکت کنن، این کار خیلی خودخواهانه‌ست. ما باید سعی کنیم از یه روش استاندارد عمومی که همه بهش دسترسی دارن و می‌تونن از کلی مطلب موجود اون رو یاد بگیرن استفاده کنیم تا اینکه چرخ‌های رنگارنگ جدید تولید کنیم.<p>استیت منجرها یا State Managerها برای همین ساخته شدن. برای اینکه تصاحب این متغیرها از روی دوش کامپوننت‌ها برداشته بشن. اونها در عوض میان وسط و توی هر کامپوننت یه آبجکت میدن که ما میتونیم متغیرها رو توی اون بنویسیم. هرکس دیگه‌ای هم از فامیل خواست به اون‌ها دسترسی داشته باشه، می‌تونیم حق دسترسی بهشون بدیم و متوجه بشیم کی سعی می‌کنن تغییرش بدن. درواقع این عضو خانواده رو می‌تونید شخص مادر توی هر فامیل این خونواده بزرگ درنظر بگیرید. مادرها از تغییرات فرزنداشون خبردار می‌شن و با یه زنگ به خاله و عمه‌ها می‌تونن حال‌واحوال اونها رو جویا بشن و اتفاقات خونوادگی رو باهاشون در میون بذارن. توی حالت جدید، ارتباط بخش‌های برنامه در یک فریمورک خاص مثل Vue بصورت زیر می‌شه.<p><img src="https://www.dropbox.com/s/e4eor49y6511nod/vuex.png?raw=1" alt="عکس" /><h2 id="کی-به-state-managerها-نیاز-پیدا-میکنم">کی به State Managerها نیاز پیدا می‌کنم؟</h2><p>این سوالیه که جوابش دست شماست. اگرچه خود فریم‌ورک‌های ویو و ری‌اکت و… می‌تونن متغیرهای ما رو نگه‌داری کنن و امکانات و متودهایی برای تغییر اون‌ها و باخبرشدن از تغییراتشون در اختیار ما قرار میذارن، اما موضوع اندازه برنامه ماست. اگر برنامه‌تون داره بزرگ می‌شه و دارید توی نگه‌داری متغیرها به مشکل می‌خورید و اوضاع پیچیده شده، قدم بعدیتون می‌تونه State Manager باشه. درنهایت، توضیحات این مطلب رو با یک جمله آب‌طلاپسند از Dan Abramov، سازنده لایبرری Redux به پایان می‌برم:<blockquote><p>کتابخونه های <a href="https://facebook.github.io/flux/">فلاکس</a> مثل عینک می‌مونن، وقتی بهشون نیاز داشته باشی، خودت میفهمی.</blockquote></div><div class="post__share text--center"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/%D9%86%DA%AF%D9%87-%D8%AF%D8%A7%D8%B1%DB%8C-%D9%85%D8%AA%D8%BA%DB%8C%D8%B1%D9%87%D8%A7-%D8%AA%D9%88%DB%8C-%D9%BE%D8%B1%D9%88%DA%98%D9%87-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D8%AC%D8%A7%D9%88%D8%A7%D8%B3%DA%A9%D8%B1%DB%8C%D9%BE%D8%AA/&via=http://pullrequest.ir&text=نگه‌داری متغیرها توی پروژه‌های بزرگ در جاواسکریپت"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/%D9%86%DA%AF%D9%87-%D8%AF%D8%A7%D8%B1%DB%8C-%D9%85%D8%AA%D8%BA%DB%8C%D8%B1%D9%87%D8%A7-%D8%AA%D9%88%DB%8C-%D9%BE%D8%B1%D9%88%DA%98%D9%87-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D8%AC%D8%A7%D9%88%D8%A7%D8%B3%DA%A9%D8%B1%DB%8C%D9%BE%D8%AA/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul></div><script> window.pr.methods.docReady(function() { var singleEntry = window.pr.methods.selectElementByClassName('.post__entry--single'); var excerptEntry = window.pr.methods.selectElementByClassName('.post__excerpt'); if (singleEntry) window.pr.methods.parseTextForEmojis(singleEntry); else if (excerptEntry) window.pr.methods.parseTextForEmojis(excerptEntry); }) </script><hr /><div class="comments"><div id="disqus_thread"></div><script async defer src='https://pwl-rykhwyst.disqus.com/embed.js' onerror="disqusHandler();"></script> <script type="text/javascript"> var disqusHandler = (function (w) { var methods = w.pr.methods; /* methods.docReady(function () { loadDisqusScript() }); function loadDisqusScript() { methods.getAjax('https://pwl-rykhwyst.disqus.com/embed.js', null, function (e) { addDisqusErrorIfNotPresent(); // Parse any emoji inside error methods.parseTextForEmojis(document.getElementById('comment__error')); }) } */ function addDisqusErrorIfNotPresent() { var comments = methods.selectElementByClassName('.comments'); /* Add only for the 1st time */ if (!methods.selectElementById('comment__error')) { /* Add error to .comments */ comments.appendChild(createDisqusError()); /* Parse any emoji inside error */ methods.parseTextForEmojis(document.getElementById('comment__error')); } } function createDisqusError() { var err = document.createElement('div'); err.id = 'comment__error'; window.pr.methods.addClass('alert', err); err.innerHTML = 'اگر این پیام رو میبینین، به این معنیه که اسکریپت Disqus براتون لود نشده. سرویس Disqus توی ایران فیلتر شده!! <strong>لطفا وی پی ان تون رو روشن کنین و صفحه فعلی رو ریفرش کنین.</strong> :پی'; return err; } return addDisqusErrorIfNotPresent; })(window); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></article></div><footer class="site__footer clearfix"><div class="site__footer__brand" onclick="window.pr.methods.goToTop()"> <img class="img-block" src="/assets/images/pr.svg" alt="PR"></div><div class="container clearfix"><nav class="pull-right site__footer__menu"><ul class="list--unstyled list--inline site__footer__list"><li> <a target="_blank" href="https://github.com/pr-techblog"> <i class="icon pricon-github"></i> گیتهاب </a><li> <a target="_blank" href="https://twitter.com/pr_techblog"> <i class="icon pricon-twitter"></i> توییتر </a></ul></nav><div class="pull-left text--ltr site__footer__copyright">Made with ❦ @ <strong>PullRequest</strong></div></div></footer></div><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93910742-1', 'auto'); ga('send', 'pageview', { 'page': '/%D9%86%DA%AF%D9%87-%D8%AF%D8%A7%D8%B1%DB%8C-%D9%85%D8%AA%D8%BA%DB%8C%D8%B1%D9%87%D8%A7-%D8%AA%D9%88%DB%8C-%D9%BE%D8%B1%D9%88%DA%98%D9%87-%D9%87%D8%A7%DB%8C-%D8%A8%D8%B2%D8%B1%DA%AF-%D8%AF%D8%B1-%D8%AC%D8%A7%D9%88%D8%A7%D8%B3%DA%A9%D8%B1%DB%8C%D9%BE%D8%AA/', 'title': 'نگه‌داری متغیرها توی پروژه‌های بزرگ در جاواسکریپت' }); </script>
