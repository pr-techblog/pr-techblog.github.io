<!DOCTYPE html><html><head><title>مدیریت و اجرای یک process به کمک launchd در سیستم عامل macos</title><meta charset="utf-8" /><meta content='text/html; charset=utf-8' http-equiv='Content-Type'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'><meta property="og:locale" content="fa_IR" /><meta property="og:site_name" content="پول ریکوئست" /><meta name="twitter:image" content="/assets/images/pr.svg" /><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="theme-color" content="#000"><meta property="og:type" content="article" /><meta name="description" content="معمولا در سیستم‌های شبه یونیکس و تقریبا همه سیستم عامل‌ها برای مدیریت، راه‌اندازی و توقف اجرای یک process، سرویس یا اسکریپت در سیستم عامل از ابزارهای به نام operating system service management استفاده می‌شود. " /><meta property="og:description" content="معمولا در سیستم‌های شبه یونیکس و تقریبا همه سیستم عامل‌ها برای مدیریت، راه‌اندازی و توقف اجرای یک process، سرویس یا اسکریپت در سیستم عامل از ابزارهای به نام operating system service management استفاده می‌شود. " /><meta name="twitter:card" content="summary" /><meta name="twitter:description" content="معمولا در سیستم‌های شبه یونیکس و تقریبا همه سیستم عامل‌ها برای مدیریت، راه‌اندازی و توقف اجرای یک process، سرویس یا اسکریپت در سیستم عامل از ابزارهای به نام operating system service management استفاده می‌شود. " /><meta name="author" content="پول ریکوئست به قلم arastu" /><meta property="og:title" content="مدیریت و اجرای یک process به کمک launchd در سیستم عامل macos" /><meta property="twitter:title" content="مدیریت و اجرای یک process به کمک launchd در سیستم عامل macos" /><link rel="stylesheet" type="text/css" href="/style.css" /><link rel="alternate" type="application/rss+xml" title="پول ریکوئست - پول ریکوئست، دست نوشته های فنی فارسی زبان" href="/feed.xml" /> <script src="/pr.js"></script><body><div class="site__container"><header class="site__header container"><figure class="site__header__brand"> <a href="http://pullrequest.ir"> <img src="/assets/images/pr.svg" alt="PR"> </a></figure><nav class="site__header__nav"><ul class="list--unstyled list--inline header__list text--center"><li> <a href="/about">پول ریکوئست چیست</a><li> <a href="/pr-authors">نویسندگان</a><li> <a href="/contribute">راهنمای انتشار مطالب در پول ریکوئست</a></ul></nav></header><hr class="site__header__divider container" /><main role="main" class="container"><article class="post post--single"><h1 class="post__title post__title--single">مدیریت و اجرای یک process به کمک launchd در سیستم عامل macos</h1><div class="post__info"> <span> <span class="lazyimage"> <img onload="window.pr.methods.addClass('img-loaded', this.parentNode)" onerror="window.pr.methods.addClass('img-error', this)" src="/assets/images/arastu.jpeg" alt="توحید ارسطو" class="img-rounded post__info__figure inline--middle" > </span> <span class="inline--middle post__author"><a href="http://pullrequest.ir/authors/arastu">توحید ارسطو</a></span> </span> <small><em>1396-2-21</em></small></div><div class="post__share text--left"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/manage-and-run-a-process-with-launchd/&via=http://pullrequest.ir&text=مدیریت و اجرای یک process به کمک launchd در سیستم عامل macos"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/manage-and-run-a-process-with-launchd/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul><nav class="post__tags post__tags--single"> <i class="icon pricon-tag"></i><ul class="list--unstyled list--inline"><li><a href="/tag/macos">#macos</a><li><a href="/tag/process">#process</a><li><a href="/tag/launchd">#launchd</a><li><a href="/tag/systemd">#systemd</a><li><a href="/tag/upstart">#upstart</a><li><a href="/tag/sysvinit">#sysvinit</a></ul></nav></div><div class="post__entry post__entry--single"><p>معمولا در سیستم‌های شبه یونیکس و تقریبا همه سیستم عامل‌ها برای مدیریت، راه‌اندازی و توقف اجرای یک process، سرویس یا اسکریپت در سیستم عامل از ابزارهای به نام operating system service management استفاده می‌شود.<p>مثالهایی از این ابزارها در سیستم عامل‌های مختلف در لیست زیر آماده است:<ul><li>سیستم عامل ویندوز: <a href="https://en.wikipedia.org/wiki/Service_Control_Manager">Service Control Manager</a><li>سیتم عامل Mac Os اپل: <a href="https://en.wikipedia.org/wiki/Launchd">launchd</a><li>سیستم عامل کروم گوگل: <a href="https://en.wikipedia.org/wiki/Upstart">Upstart</a><li>بسیاری از توزیع‌های لینوکس: <a href="https://en.wikipedia.org/wiki/Systemd">systemd</a><li>سولاریس: <a href="https://en.wikipedia.org/wiki/Service_Management_Facility">Service Management Facility</a><li>اندروید: <a href="http://elinux.org/Android_Booting#.27init.27">Android init</a><li>سیستم عامل‌های شبه یونیکس قدیمی: <a href="https://en.wikipedia.org/wiki/Sysvinit">sysvinit</a><li>جنتو: <a href="https://en.wikipedia.org/wiki/OpenRC">OpenRC</a></ul><p>به زبان ساده‌تر همه این سیستم‌ها کمک می‌کنند process ها برای مدت طولانی بدون نیاز به ما اجزا شوند و در صورت ریستارت شدن ماشین و بقیه مشکلات خود بخود دوباره اجرا شوند. با توجه به اینکه این processها برای مدت طولانی به حال خود رها می‌شوند باید Log و Error های خود را در جایی(مثلا فایل) ذخیره کنند تا در هنگام بروز مشکلات و یا برای بررسی صحت اجرای آن پروسس به آن مراجعه کنیم. این سیستم‌ها همه این کارها را انجام می‌دهند و با داشتن ابزارهایی برای کنترل و مانیتور کردن processها به ما کمک بسیاری می‌کنند.<p>شیوه کارکرد اکثر این ابزارها بدین صورت است که شما در یک فایل process خود را توصیف می‌کنید. توصیف می‌کنیم یعنی چیکار می‌کنیم؟ یعنی مثلا می‌گیم فایل اجرایی این process کجاست، لاگ‌ها و اررورها را در چه مسیری ذخیره کند. برای اجرای process چه آرگیومنت‌هایی هنگام اجرای process به آن بدهد. و هر کاری برای اجرای درست آن process لازم است.<p>در سیستم عامل مثلا :) شبه یونیکس مک هم ابزاری به نام launchd این کار را انجام می‌دهد.در این نوشته ما می‌خواهیم اجرای یک process فرضی به نام crushanalyzer که ابزاری است که به طور مرتب شبکه‌های اجتماعی را برای رصد کردن فعالیت‌های کراش شما و اطلاع دادن آنها به شما پایش می‌کند را به ابزار launchd بسپاریم تا خود را از دردسر‌های اجرا و مدیریت آن رها کنیم.<p>فرض کنید این ابزار را شما با زبان c++ در مسیر <code class="highlighter-rouge">$HOME/Workspace/crushanalyzer</code> ایجاد کرده اید. بعد از کامپایل شدن خروجی این کد یک فایل باینری به نام crushfinderd در همین مسیر است. شما معمولا برای اینکه راحت باشید و به اصطاح این فایل در $PATH باشد معمولا بعد از کامپایل آن را در مسیر<code class="highlighter-rouge">/usr/local/bin</code> کپی می‌کنید و در ترمینال آن را به شکل زیر اجرا می‌کنید:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TWITTER_TOKEN</span><span class="o">=</span><span class="s2">"mdjnfh89therbge9urtye9rht95ty3840ty3890ty3"</span>
<span class="nb">export </span><span class="nv">FACEBOOK_TOKEN</span><span class="o">=</span><span class="s2">"kdjhfsldhfaildhfsdlfhsjkfhsjkadfhaowiruyt48yeuryw984yr"</span>
<span class="nb">export </span><span class="nv">INSTAGRAM_TOKEN</span><span class="o">=</span><span class="s2">"kejhrohio4uy5384953ty98nto389yt9v235ty59tby4958by49"</span>
crushfinder start <span class="nt">--config</span> <span class="nv">$HOME</span>/.crushfinder.yaml <span class="nt">--interval</span> 40 <span class="nt">--alert</span> sms
</code></pre></div></div><p>وقتی این کد را اجرا می‌کنید لاگ و خروجی و اررور‌های این process را در ترمینال می‌بینید. اگر ترمینال را ببندید یا «مک بوک پرو ۲۰۱۶ اسپیس گریتان» ریستارت شود یا حتی خود این پروسس کرش کند مجبورید همه این مراحل را دوباره انجام دهید. اینجاست که ابزار launchd به دادتان می‌رسد شما توضیحاتتان و روش اجرای این پروسه را به launchd می‌دهید و این موجود خودش مانند پلیس فتا حواسش به همه چی و همه جا هست و اجرای درست آن را کنترل می‌کند.<p>برای تعریف مشخصات و روش اجرای پروژه باید یک فایل xml با پسوند plist ایجاد کنید و با یک سینتکس مشخص مشخصات پروسس را در آن تعریف کنید.<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>ir.arastu.crushanalyzer<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>EnvironmentVariables<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;dict&gt;</span>
        <span class="nt">&lt;key&gt;</span>TWITTER_TOKEN<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>mdjnfh89therbge9urtye9rht95ty3840ty3890ty3<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>FACEBOOK_TOKEN<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>kdjhfsldhfaildhfsdlfhsjkfhsjkadfhaowiruyt48yeuryw984yr<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;key&gt;</span>INSTAGRAM_TOKEN<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;string&gt;</span>kejhrohio4uy5384953ty98nto389yt9v235ty59tby4958by49<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;array&gt;</span>
        <span class="nt">&lt;string&gt;</span>/usr/local/bin/crushanalyzer<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>start<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>--config<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>$HOME/.crushfinder.yaml<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>--interval<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>40<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>--alert<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>sms<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/array&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>/tmp/crushfinder-stdout.log<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>/tmp/crushfinder-stderr.log<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>Debug<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;true/&gt;</span>
    <span class="nt">&lt;key&gt;</span>KeepAlive<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;true/&gt;</span>
    <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
	 <span class="nt">&lt;true/&gt;</span>
    <span class="nt">&lt;key&gt;</span>Disabled<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;false/&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</code></pre></div></div><p>خب در این فایل Environment variableهای لازم و کامند لازم برای اجرای این process را به launchd معرفی کردیم. همانطور که مشاهده می‌کنید فایلهای مربوط به error و log را نیز به آن معرفی کردیم. چیزهای اضافی تری نیز به launchd در این فایل توصیف داده ایم مثلا:<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;key&gt;KeepAlive&lt;/key&gt;
&lt;true/&gt;
&lt;key&gt;RunAtLoad&lt;/key&gt;
&lt;true/&gt;
</code></pre></div></div><p>این خطوط به launchd می‌فهماند که این process را بعد از هر اتفاقی که منجر به از کار افتادن آن شد دوباره راه اندازی کند و همینطور در ابتدای راه اندازی سیستم عامل نیز آن را راه اندازی کند.<p>برای اینکه launchd کنترل این process که در فایل plist توصیف شد را به دست بگیرد از ابزار launchctl در مک استفاده می‌شود. ابتدا این فایل را در مسیر <code class="highlighter-rouge">$HOME/Library/LaunchAgents</code> کپی کنید و سپس برای اجرای آن دستور زیر را در کامند لاین مک بزنید:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>launchctl load <span class="nv">$HOME</span>/Library/LaunchAgents/ir.arastu.crushanalyzer.plist
</code></pre></div></div><p>اگر همه چیز به درستی پیش رفته باشد با زدن دستور <code class="highlighter-rouge">launchctl list</code> باید این process را در لیست پراسس‌های فعلی ببینید، خروجی چیزی شبیه به این خواهد بود:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>363	0	ir.arastu.crushanalyzer
387	0	homebrew.mxcl.persiancalendar
327	0	com.apple.Spotlight
346	0	com.apple.soagent
528	0	com.apple.accessibility.mediaaccessibilityd
</code></pre></div></div><p>صفر به معنای موفقیت آمیز بودن شروع اجرای این process خواهد بود. در اکثر operating system service management کار به همین شیوه و سبک انجام می‌شود اگر چه ممکن است دستورات و فرمت توصیف process متفاوت باشد.<p>امیدوارم از این نوشته لذت برده باشید.<p>نوشته شده با ویرایشگر <a href="http://www.sobhe.ir/moratab/">مرتب</a></div><div class="post__share text--center"><ul class="list--unstyled list--inline"><li><a class="button button--with-icon" target="_blank" href="https://twitter.com/intent/tweet?url=/manage-and-run-a-process-with-launchd/&via=http://pullrequest.ir&text=مدیریت و اجرای یک process به کمک launchd در سیستم عامل macos"> <i class="icon pricon-twitter"></i> توییتر </a><li><a class="button button--with-icon" target="_blank" href="https://telegram.me/share/url?url=http://pullrequest.ir/manage-and-run-a-process-with-launchd/"> <i class="icon pricon-telegram"></i> تلگرام </a></ul></div><script> window.pr.methods.docReady(function() { var singleEntry = window.pr.methods.selectElementByClassName('.post__entry--single'); var excerptEntry = window.pr.methods.selectElementByClassName('.post__excerpt'); if (singleEntry) window.pr.methods.parseTextForEmojis(singleEntry); else if (excerptEntry) window.pr.methods.parseTextForEmojis(excerptEntry); }) </script><hr /><div class="comments"><div id="disqus_thread"></div><script async defer src='https://pwl-rykhwyst.disqus.com/embed.js' onerror="disqusHandler();"></script> <script type="text/javascript"> var disqusHandler = (function (w) { var methods = w.pr.methods; /* methods.docReady(function () { loadDisqusScript() }); function loadDisqusScript() { methods.getAjax('https://pwl-rykhwyst.disqus.com/embed.js', null, function (e) { addDisqusErrorIfNotPresent(); // Parse any emoji inside error methods.parseTextForEmojis(document.getElementById('comment__error')); }) } */ function addDisqusErrorIfNotPresent() { var comments = methods.selectElementByClassName('.comments'); /* Add only for the 1st time */ if (!methods.selectElementById('comment__error')) { /* Add error to .comments */ comments.appendChild(createDisqusError()); /* Parse any emoji inside error */ methods.parseTextForEmojis(document.getElementById('comment__error')); } } function createDisqusError() { var err = document.createElement('div'); err.id = 'comment__error'; window.pr.methods.addClass('alert', err); err.innerHTML = 'اگر این پیام رو میبینین، به این معنیه که اسکریپت Disqus براتون لود نشده. سرویس Disqus توی ایران فیلتر شده!! <strong>لطفا وی پی ان تون رو روشن کنین و صفحه فعلی رو ریفرش کنین.</strong> :پی'; return err; } return addDisqusErrorIfNotPresent; })(window); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></article></div><footer class="site__footer clearfix"><div class="site__footer__brand" onclick="window.pr.methods.goToTop()"> <img class="img-block" src="/assets/images/pr.svg" alt="PR"></div><div class="container clearfix"><nav class="pull-right site__footer__menu"><ul class="list--unstyled list--inline site__footer__list"><li> <a target="_blank" href="https://github.com/pr-techblog"> <i class="icon pricon-github"></i> گیتهاب </a><li> <a target="_blank" href="https://twitter.com/pr_techblog"> <i class="icon pricon-twitter"></i> توییتر </a></ul></nav><div class="pull-left text--ltr site__footer__copyright">Made with ❦ @ <strong>PullRequest</strong></div></div></footer></div><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-93910742-1', 'auto'); ga('send', 'pageview', { 'page': '/manage-and-run-a-process-with-launchd/', 'title': 'مدیریت و اجرای یک process به کمک launchd در سیستم عامل macos' }); </script>
